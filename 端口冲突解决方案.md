# ğŸ”§ Node.js é¡¹ç›®ç«¯å£å†²çªé—®é¢˜å½»åº•è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

åœ¨å¼€å‘ Node.js å…¨æ ˆé¡¹ç›®æ—¶ï¼Œç»å¸¸é‡åˆ°ç«¯å£å†²çªé—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å‰ç«¯ï¼ˆReact/Viteï¼‰å’Œåç«¯ï¼ˆExpressï¼‰åŒæ—¶è¿è¡Œæ—¶ã€‚æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†ç«¯å£å†²çªçš„æ ¹æœ¬åŸå› ï¼Œå¹¶æä¾›äº†å½»åº•çš„è§£å†³æ–¹æ¡ˆã€‚

## ğŸ¯ å¸¸è§é—®é¢˜ç°è±¡

- âœ… `Port 3000 is in use, trying another one...`
- âœ… `EADDRINUSE: address already in use :::3001`
- âœ… å‰ç«¯å°è¯•ä½¿ç”¨åç«¯ç«¯å£ï¼ˆ3001ï¼‰
- âœ… å¤šä¸ªè¿›ç¨‹å ç”¨åŒä¸€ç«¯å£
- âœ… æœåŠ¡å¯åŠ¨åAPIæ— æ³•è®¿é—®ï¼ˆ404é”™è¯¯ï¼‰

## ğŸ“Š é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

### 1. **å¤šè¿›ç¨‹æ®‹ç•™é—®é¢˜** 
- **åŸå› **: Node.jsè¿›ç¨‹å¼‚å¸¸ç»ˆæ­¢åç«¯å£èµ„æºæœªé‡Šæ”¾
- **ç°è±¡**: `netstat`æ˜¾ç¤ºå¤šä¸ªPIDå ç”¨åŒä¸€ç«¯å£
- **å½±å“**: æ–°å¯åŠ¨çš„æœåŠ¡æ— æ³•ç»‘å®šç«¯å£

### 2. **PowerShellå¹¶å‘å¯åŠ¨é—®é¢˜**
- **åŸå› **: åŒæ—¶å¯åŠ¨å‰åç«¯å¯¼è‡´ç«äº‰æ¡ä»¶
- **ç°è±¡**: å‰ç«¯å°è¯•ä½¿ç”¨3001ç«¯å£ï¼ˆè¢«åç«¯å ç”¨ï¼‰
- **å½±å“**: Viteè‡ªåŠ¨åˆ‡æ¢ç«¯å£ï¼Œå¯¼è‡´æ··ä¹±

### 3. **åå°è¿›ç¨‹è¿½è¸ªå›°éš¾**
- **åŸå› **: `&` å’Œ `Start-Job` åˆ›å»ºçš„åå°è¿›ç¨‹éš¾ä»¥ç®¡ç†
- **ç°è±¡**: è¿›ç¨‹æ®‹ç•™ï¼Œæ‰‹åŠ¨ç»ˆæ­¢å›°éš¾
- **å½±å“**: é‡å¤å¯åŠ¨ç´¯ç§¯æ›´å¤šå†²çªè¿›ç¨‹

### 4. **PowerShellè¯­æ³•é™åˆ¶**
- **åŸå› **: Windows PowerShellä¸æ”¯æŒ `&&` è¯­æ³•
- **ç°è±¡**: `cd backend && node server.js` æŠ¥é”™
- **å½±å“**: æ— æ³•åœ¨å•è¡Œä¸­åˆ‡æ¢ç›®å½•å¹¶å¯åŠ¨æœåŠ¡

## ğŸ› ï¸ å½»åº•è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: è‡ªåŠ¨åŒ–æ¸…ç†è„šæœ¬

åˆ›å»º `cleanup.ps1`:

```powershell
#!/usr/bin/env pwsh

Write-Host "ğŸ§¹ æ­£åœ¨æ¸…ç†ç«¯å£å ç”¨..." -ForegroundColor Yellow

# åœæ­¢æ‰€æœ‰Node.jsè¿›ç¨‹
try {
    Get-Process -Name "node" -ErrorAction SilentlyContinue | Stop-Process -Force
    Write-Host "âœ… å·²åœæ­¢æ‰€æœ‰Node.jsè¿›ç¨‹" -ForegroundColor Green
} catch {
    Write-Host "âš ï¸ æ²¡æœ‰æ‰¾åˆ°Node.jsè¿›ç¨‹æˆ–å·²åœæ­¢" -ForegroundColor Yellow
}

# æ¸…ç†ç‰¹å®šç«¯å£å ç”¨
$ports = @(3000, 3001)
foreach ($port in $ports) {
    try {
        $connections = netstat -aon | Select-String ":$port "
        if ($connections) {
            $pids = $connections | ForEach-Object { 
                ($_.ToString() -split '\s+')[-1] 
            } | Where-Object { $_ -match '^\d+$' -and $_ -ne "0" } | Sort-Object -Unique
            
            foreach ($pid in $pids) {
                try {
                    Stop-Process -Id $pid -Force -ErrorAction SilentlyContinue
                    Write-Host "âœ… å·²åœæ­¢å ç”¨ç«¯å£ $port çš„è¿›ç¨‹ PID: $pid" -ForegroundColor Green
                } catch {
                    Write-Host "âš ï¸ æ— æ³•åœæ­¢è¿›ç¨‹ PID: $pid" -ForegroundColor Yellow
                }
            }
        }
    } catch {
        Write-Host "âš ï¸ æ£€æŸ¥ç«¯å£ $port æ—¶å‡ºé”™" -ForegroundColor Yellow
    }
}

# éªŒè¯ç«¯å£é‡Šæ”¾
Write-Host "ğŸ” éªŒè¯ç«¯å£çŠ¶æ€..." -ForegroundColor Cyan
$port3000 = netstat -aon | Select-String ":3000 "
$port3001 = netstat -aon | Select-String ":3001 "

if ($port3000) {
    Write-Host "âš ï¸ ç«¯å£ 3000 ä»è¢«å ç”¨" -ForegroundColor Red
} else {
    Write-Host "âœ… ç«¯å£ 3000 å·²é‡Šæ”¾" -ForegroundColor Green
}

if ($port3001) {
    Write-Host "âš ï¸ ç«¯å£ 3001 ä»è¢«å ç”¨" -ForegroundColor Red
} else {
    Write-Host "âœ… ç«¯å£ 3001 å·²é‡Šæ”¾" -ForegroundColor Green
}

Write-Host "ğŸ‰ ç«¯å£æ¸…ç†å®Œæˆï¼" -ForegroundColor Green
```

### æ–¹æ¡ˆ2: æ­£ç¡®çš„å¯åŠ¨è„šæœ¬

åˆ›å»º `start.ps1`:

```powershell
#!/usr/bin/env pwsh

Write-Host "ğŸš€ å¯åŠ¨æ™ºèƒ½å›¾ç‰‡è¯†åˆ«ç³»ç»Ÿ..." -ForegroundColor Green

# 1. æ¸…ç†ç¯å¢ƒ
& .\cleanup.ps1

# 2. å¯åŠ¨åç«¯ (å…ˆå¯åŠ¨ï¼Œç¡®ä¿3001ç«¯å£è¢«å ç”¨)
Write-Host "ğŸ”§ å¯åŠ¨åç«¯æœåŠ¡..." -ForegroundColor Cyan
Push-Location backend
Start-Process PowerShell.exe -ArgumentList "-NoExit", "-Command", "node server.js"
Pop-Location

# 3. ç­‰å¾…åç«¯å®Œå…¨å¯åŠ¨
Write-Host "â³ ç­‰å¾…åç«¯å¯åŠ¨..." -ForegroundColor Yellow
Start-Sleep -Seconds 5

# 4. éªŒè¯åç«¯
try {
    $response = Invoke-WebRequest -Uri "http://localhost:3001/health" -TimeoutSec 5 -ErrorAction Stop
    Write-Host "âœ… åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ" -ForegroundColor Green
} catch {
    Write-Host "âŒ åç«¯æœåŠ¡å¯åŠ¨å¤±è´¥" -ForegroundColor Red
    Write-Host "é”™è¯¯ä¿¡æ¯: $($_.Exception.Message)" -ForegroundColor Red
    return
}

# 5. å¯åŠ¨å‰ç«¯ (åå¯åŠ¨ï¼Œä½¿ç”¨3000ç«¯å£)
Write-Host "ğŸ¨ å¯åŠ¨å‰ç«¯æœåŠ¡..." -ForegroundColor Cyan
Start-Process PowerShell.exe -ArgumentList "-NoExit", "-Command", "npm run dev"

# 6. ç­‰å¾…å‰ç«¯å¯åŠ¨
Start-Sleep -Seconds 8

# 7. éªŒè¯å‰ç«¯
try {
    $response = Invoke-WebRequest -Uri "http://localhost:3000" -TimeoutSec 5 -ErrorAction Stop
    Write-Host "âœ… å‰ç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ" -ForegroundColor Green
} catch {
    Write-Host "âŒ å‰ç«¯æœåŠ¡å¯åŠ¨å¤±è´¥" -ForegroundColor Red
    Write-Host "é”™è¯¯ä¿¡æ¯: $($_.Exception.Message)" -ForegroundColor Red
}

# 8. æ˜¾ç¤ºæœ€ç»ˆçŠ¶æ€
Write-Host "ğŸ“Š æœåŠ¡çŠ¶æ€:" -ForegroundColor Cyan
Write-Host "================================" -ForegroundColor Green

$port3000Final = netstat -aon | Select-String ":3000.*LISTENING"
$port3001Final = netstat -aon | Select-String ":3001.*LISTENING"

if ($port3001Final) {
    Write-Host "âœ… åç«¯æœåŠ¡: http://localhost:3001 (è¿è¡Œä¸­)" -ForegroundColor Green
} else {
    Write-Host "âŒ åç«¯æœåŠ¡: æœªè¿è¡Œ" -ForegroundColor Red
}

if ($port3000Final) {
    Write-Host "âœ… å‰ç«¯æœåŠ¡: http://localhost:3000 (è¿è¡Œä¸­)" -ForegroundColor Green
} else {
    Write-Host "âŒ å‰ç«¯æœåŠ¡: æœªè¿è¡Œ" -ForegroundColor Red
}

Write-Host "================================" -ForegroundColor Green
Write-Host "ğŸ‰ å¯åŠ¨å®Œæˆï¼è¯·è®¿é—® http://localhost:3000" -ForegroundColor Green
```

### æ–¹æ¡ˆ3: ç¯å¢ƒå˜é‡æ§åˆ¶ç«¯å£

#### ä¿®æ”¹ `package.json`:
```json
{
  "scripts": {
    "dev": "cross-env PORT=3000 vite --port 3000 --strictPort",
    "backend": "cross-env PORT=3001 node backend/server.js",
    "start:backend": "cd backend && node server.js",
    "start:frontend": "vite --port 3000 --strictPort"
  },
  "devDependencies": {
    "cross-env": "^7.0.3"
  }
}
```

#### ä¿®æ”¹ `vite.config.js`:
```javascript
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 3000,
    strictPort: true, // å¦‚æœç«¯å£è¢«å ç”¨åˆ™æŠ¥é”™è€Œä¸æ˜¯åˆ‡æ¢
    host: 'localhost'
  }
})
```

#### ä¿®æ”¹åç«¯ `server.js`:
```javascript
const PORT = process.env.PORT || 3001;

app.listen(PORT, () => {
  console.log(`ğŸš€ æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:${PORT}`);
  console.log(`ğŸ“Š å¥åº·æ£€æŸ¥: http://localhost:${PORT}/health`);
});
```

### æ–¹æ¡ˆ4: Dockerå®¹å™¨åŒ–è§£å†³

åˆ›å»º `docker-compose.yml`:
```yaml
version: '3.8'
services:
  backend:
    build: 
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
    container_name: ocr-backend
    restart: unless-stopped
  
  frontend:
    build: 
      context: .
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
    depends_on:
      - backend
    container_name: ocr-frontend
    restart: unless-stopped
```

åˆ›å»ºåç«¯ `backend/Dockerfile`:
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3001
CMD ["node", "server.js"]
```

åˆ›å»ºå‰ç«¯ `Dockerfile`:
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
```

## ğŸš€ æ¨èçš„æœ€ä½³å®è·µ

### æ—¥å¸¸å¼€å‘æµç¨‹:

#### 1. **å¼€å‘å¼€å§‹å‰**:
```powershell
# æ–¹æ³•1: ä½¿ç”¨è„šæœ¬
.\cleanup.ps1

# æ–¹æ³•2: æ‰‹åŠ¨æ¸…ç†
Get-Process -Name "node" -ErrorAction SilentlyContinue | Stop-Process -Force
```

#### 2. **å¯åŠ¨é¡ºåº**:
```powershell
# æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
.\start.ps1

# æ–¹æ³•2: æ‰‹åŠ¨å¯åŠ¨
# å…ˆå¯åŠ¨åç«¯
cd backend
node server.js

# ç­‰å¾…5ç§’ååœ¨æ–°ç»ˆç«¯å¯åŠ¨å‰ç«¯
npm run dev
```

#### 3. **å¼€å‘ç»“æŸå**:
```powershell
# ä¼˜é›…åœæ­¢: åœ¨å„ä¸ªç»ˆç«¯ä¸­æŒ‰ Ctrl+C

# æˆ–å¼ºåˆ¶æ¸…ç†
Get-Process -Name "node" | Stop-Process -Force
```

### é¢„é˜²æªæ–½:

1. **è¿›ç¨‹ç›‘æ§**: å®šæœŸæ£€æŸ¥ç«¯å£å ç”¨
   ```powershell
   netstat -aon | findstr ":3000\|:3001"
   ```

2. **IDEé…ç½®**: åœ¨VSCodeä¸­é…ç½®ä»»åŠ¡è‡ªåŠ¨åŒ–å¯åŠ¨æµç¨‹
   
   åˆ›å»º `.vscode/tasks.json`:
   ```json
   {
     "version": "2.0.0",
     "tasks": [
       {
         "label": "æ¸…ç†ç«¯å£",
         "type": "shell",
         "command": "PowerShell",
         "args": ["-ExecutionPolicy", "Bypass", "-File", "cleanup.ps1"],
         "group": "build"
       },
       {
         "label": "å¯åŠ¨ç³»ç»Ÿ",
         "type": "shell", 
         "command": "PowerShell",
         "args": ["-ExecutionPolicy", "Bypass", "-File", "start.ps1"],
         "group": "build",
         "dependsOn": "æ¸…ç†ç«¯å£"
       }
     ]
   }
   ```

3. **ç«¯å£æ£€æµ‹**: åœ¨å¯åŠ¨è„šæœ¬ä¸­åŠ å…¥ç«¯å£å ç”¨æ£€æµ‹

4. **å¼‚å¸¸å¤„ç†**: ä¸ºå¯åŠ¨è„šæœ¬æ·»åŠ é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶

## ğŸ“ é—®é¢˜æ’æŸ¥æ¸…å•

å½“é‡åˆ°ç«¯å£å†²çªæ—¶ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºæ’æŸ¥:

### âœ… ç¬¬ä¸€æ­¥: æ£€æŸ¥ç«¯å£å ç”¨
```powershell
netstat -aon | findstr ":3000\|:3001"
```

### âœ… ç¬¬äºŒæ­¥: åœæ­¢æ‰€æœ‰Nodeè¿›ç¨‹
```powershell
Get-Process -Name "node" | Stop-Process -Force
```

### âœ… ç¬¬ä¸‰æ­¥: éªŒè¯ç«¯å£é‡Šæ”¾
```powershell
# é‡æ–°æ£€æŸ¥ï¼Œåº”è¯¥æ²¡æœ‰è¾“å‡º
netstat -aon | findstr ":3000\|:3001"
```

### âœ… ç¬¬å››æ­¥: æŒ‰åºå¯åŠ¨æœåŠ¡
```powershell
# å…ˆå¯åŠ¨åç«¯
cd backend && node server.js

# 5ç§’åå¯åŠ¨å‰ç«¯
npm run dev
```

### âœ… ç¬¬äº”æ­¥: æµ‹è¯•è¿æ¥
```powershell
# æµ‹è¯•åç«¯API
Invoke-WebRequest -Uri "http://localhost:3001/health"

# æµ‹è¯•å‰ç«¯é¡µé¢
Invoke-WebRequest -Uri "http://localhost:3000"
```

## ğŸ” å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: PowerShellè¯­æ³•é”™è¯¯
```
æ ‡è®°"&&"ä¸æ˜¯æ­¤ç‰ˆæœ¬ä¸­çš„æœ‰æ•ˆè¯­å¥åˆ†éš”ç¬¦
```
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨PowerShellè¯­æ³•åˆ†éš”å‘½ä»¤
```powershell
# âŒ é”™è¯¯
cd backend && node server.js

# âœ… æ­£ç¡®
cd backend; node server.js
# æˆ–è€…
Push-Location backend; node server.js; Pop-Location
```

### é”™è¯¯2: æ–‡ä»¶è·¯å¾„é”™è¯¯
```
Cannot find module 'D:\...\server.js'
```
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿åœ¨æ­£ç¡®ç›®å½•æ‰§è¡Œå‘½ä»¤
```powershell
# æ£€æŸ¥å½“å‰ç›®å½•
Get-Location

# è¿›å…¥æ­£ç¡®ç›®å½•
cd backend
node server.js
```

### é”™è¯¯3: Viteç«¯å£åˆ‡æ¢
```
Port 3000 is in use, trying another one...
âœ Local: http://localhost:3001/
```
**è§£å†³æ–¹æ¡ˆ**: é…ç½®strictPorté˜²æ­¢è‡ªåŠ¨åˆ‡æ¢
```javascript
// vite.config.js
export default {
  server: {
    port: 3000,
    strictPort: true
  }
}
```

## ğŸ¯ æ€»ç»“

ç«¯å£å†²çªé—®é¢˜çš„æ ¸å¿ƒåœ¨äº**è¿›ç¨‹ç®¡ç†**å’Œ**å¯åŠ¨é¡ºåº**ã€‚é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ä»¥å½»åº•è§£å†³ï¼š

1. **æ¸…ç†è„šæœ¬**: è‡ªåŠ¨åŒ–æ¸…ç†æ®‹ç•™è¿›ç¨‹
2. **å¯åŠ¨è„šæœ¬**: æ ‡å‡†åŒ–å¯åŠ¨æµç¨‹  
3. **ç«¯å£é…ç½®**: æ˜ç¡®æŒ‡å®šç«¯å£é¿å…å†²çª
4. **å®¹å™¨åŒ–**: ä½¿ç”¨Dockerå®Œå…¨éš”ç¦»ç¯å¢ƒ

éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥é¿å…99%çš„ç«¯å£å†²çªé—®é¢˜ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚

---

**åˆ›å»ºæ—¶é—´**: 2025å¹´6æœˆ10æ—¥  
**é€‚ç”¨ç³»ç»Ÿ**: Windows 10/11 + PowerShell  
**é¡¹ç›®ç±»å‹**: Node.js å…¨æ ˆé¡¹ç›®  
**ç‰ˆæœ¬**: v1.0 